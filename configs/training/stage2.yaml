# @package training
# Stage 2 training configuration

defaults:
  - /scheduler: onecyclelr
  
epochs: 1000
lr: 1.0e-4
model_dir: results/stage2
N: 20  # Number of rollout steps

# Optional features
tvd:
  enabled: false
  weight: 15.0
  weight_scheduler:
    milestones: []  # Epoch milestones for weight changes
    weights: []      # Corresponding weights

validation:
  dataset_size: 100  # Size of validation dataset

# Detaching behavior (Stage 2 only)
# SOD detaches after streaming, Cylinder doesn't
detach_after_streaming: false

# Adaptive gradient clipping settings
adaptive_clip:
  enabled: true
  alpha: 0.97      # EMA decay factor for gradient norm statistics
  z_thresh: 2.5   # Z-score threshold for triggering adaptive clipping
  warmup_steps: 1000 # Number of steps to collect gradient norms before EMA initialization
  mode: "zscore"  # Clipping mode: "zscore" or "percentile"
  clip_option: "adaptive_scaling"  # For zscore mode: "adaptive_scaling" or "mean"
  clip_factor: 1.0  # Multiplier for adaptive scaling threshold
  skip_update_on_spike: false  # Skip updating EMA statistics when spike is detected
  max_grad_norm: null # Maximum gradient norm threshold (fallback). Only set if static clipping is desired.