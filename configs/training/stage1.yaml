# @package training
# Stage 1 training configuration

defaults:
  - /scheduler: cos_anneal_wr

epochs: 1000
lr: 1.0e-3
model_dir: results/stage1

validation:
  dataset_size: 100  # Size of validation set (held out from loaded data)

# Note: Optimizer and scheduler are configured separately
# This file contains training-specific parameters

# Adaptive gradient clipping settings
adaptive_clip:
  enabled: true
  alpha: 0.97      # EMA decay factor for gradient norm statistics
  z_thresh: 2.5   # Z-score threshold for triggering adaptive clipping
  warmup_steps: 200 # Number of steps to collect gradient norms before EMA initialization
  mode: "zscore"  # Clipping mode: "zscore" or "percentile"
  clip_option: "adaptive_scaling"  # For zscore mode: "adaptive_scaling" or "mean"
  clip_factor: 1.0  # Multiplier for adaptive scaling threshold
  skip_update_on_spike: false  # Skip updating EMA statistics when spike is detected
  max_grad_norm: null # Maximum gradient norm threshold (fallback). Only set if static clipping is desired.

run_name: 'stage1'